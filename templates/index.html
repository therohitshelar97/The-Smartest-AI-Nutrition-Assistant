<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recorderjs/0.1.0/recorder.min.js"></script>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/food.jpg') }}">
    <style>
        .output-box{
            position: absolute;
            top: 10%;
            width: 60%;
            background-color: rgb(29, 27, 27);
            padding: 30px;
            margin-left: 20%;
            color:white

        }
        .span-close{
            background-color: red;
            padding: 4px;
            text-align: right;
            cursor: pointer;
            position: relative;
            left: 100%;
            margin-bottom: 40px;

        }

        .form2{
          display: none;
        }

        .input-select{
          list-style-type: none;
        }
        .input-select > li{
          display: inline-block;
          width: 100px;
        }

        .ani{
          padding: 30%;
          animation-name: eg;
          animation-timing-function: 5s;
          animation-iteration-count: infinite;
        }
        body {
            background-image: url("{{ url_for('static', filename='images/lifestyle.jpg') }}");
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            background-attachment: fixed;
        }

        /* @keyframes  eg {
           10%{font-size:40px}
           40%{font-size:20px}
           60%{font-size: 60px;}
           80%{font-size:40px}
           100%{font-size:70}
        } */
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-warning">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">The Smartest AI Nutrition Assistant</a>  
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        
        <li class="nav-item">
          <a class="nav-link disabled" ><li style="cursor: pointer;" onclick="Text()">
            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">
            <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2z"/>
            <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8m0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5"/>
          </svg>
          </li></a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled"  tabindex="-1" >
            <li style="cursor: pointer;" onclick="Image()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor" class="bi bi-card-image" viewBox="0 0 16 16">
                    <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
                    <path d="M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2zm13 1a.5.5 0 0 1 .5.5v6l-3.775-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12v.54L1 12.5v-9a.5.5 0 0 1 .5-.5z"/>
                  </svg>
                  </li>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled"  tabindex="-1" >
              <li style="cursor: pointer;" onclick="Audio()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor" class="bi bi-mic-fill" viewBox="0 0 16 16">
                    <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0z"/>
                    <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5"/>
                  </svg>
                  </li>
          </a>
        </li>
      </ul>
      <form class="d-flex">
        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Search</button>
      </form>
    </div>
    </div>
  </div>
</nav>
    {% if rel %}
                <div class="output-box" id="close">
                    <span class="span-close" onclick="Close()">close</span>
                    <!-- <p>
                        {{rel}}
                    </p> -->
                    {{ rel | safe }}
                </div>
        {% endif %}
        <div id="audio-out"></div>
       
    <div class="container">
        <div class="row mt-2">
          <div class="col-3">
            <!-- <img src="{{url_for('static',filename='images/food.jpg')}}" height="400px" width="100%" /> -->
          </div>
            <div class="col-6 ">
             
                <div class="" id="text">
                    <form action="{{url_for('handle_text_input')}}" method="POST">
                        <!-- Health_Goal:<input type="text" name="hg" class="form-control" placeholder="Enter Goal Like Weight Loss, Weight Gain etc"> -->
                        Height:<input type="text" name="height" class="form-control" placeholder="Enter Hight Like 4 feet, 5 feet etc">
                        Weight:<input type="text" name="weight" class="form-control" placeholder="Enter Hight Like 50kg feet, 90kg">
                        <label for="diet">Diet:</label>
                        <select name="diet" id="diet" class="form-select form-control">
                          <option value="">Select Diet</option>
                          <option value="Vegetarian">Vegetarian</option>
                          <option value="Non-Vegetarian">Non-Vegetarian</option>
                          <option value="Vegan">Vegan</option>
                          <option value="Seafood">Seafood</option>
                        </select>
                        allergies:<input type="text" name="allergies" class="form-control" placeholder="Enter food allergies like Meat, Chicken etc" />
                        <label for="al">Activity Level:</label>
                        <select name="al" id="al" class="form-select form-control">
                          <option value="">Select Activity Level</option>
                          <option value="Sedentary">Sedentary</option>
                          <option value="Light">Light</option>
                          <option value="Moderate">Moderate</option>
                          <option value="Active">Active</option>
                          <option value="Very Active">Very Active</option>
                        </select>
                       <label for="mt">Meal Type:</label>
                      <select name="mt" id="mt" class="form-select form-control">
                        <option value="">Select Meal Type</option>
                        <option value="Breakfast">Breakfast</option>
                        <option value="Lunch">Lunch</option>
                        <option value="Dinner">Dinner</option>
                        <option value="Snack">Snack</option>
                        <option value="Weekly Plan">Weekly Plan</option>
                        <option value="Monthly Plan">Monthly Plan</option>
                      </select>
                      medical Problem (Optional)<input type="text" class="form-control" name="medical" placeholder="Enter your Region/State" />
                      Country (optiona):<input type="text" class="form-control" name="country" placeholder="Enter your Country" />
                      State/Region (optiona):<input type="text" class="form-control" name="state" placeholder="Enter your Region/State" />
                        <br>
                        <input type="submit" value="Submit" class="btn btn-success" />
                    </form>
                </div>

                <div class="form2" id="image">
                    <form action="{{url_for('upload_image')}}" method="POST" enctype="multipart/form-data">
                        <input type="file" name="image" accept="image/*" required class="form-control">
                        <br>
                        <input type="submit" value="Upload" class="btn btn-success" />
                    </form>
                </div>
                 
                <div  id="speak1" class="form2">
                     <div >
                      <h2 class="ani" style="text-align: center;">Speak</h2>
                     </div>
                  </div>
                <div class="form2" id="audio" style="margin-left: 40%;">

                  
                  
                  <button id="startBtn" class="btn btn-danger" ><Span onclick="Speak()">Start</Span></button>
                  <button id="stopBtn" class="btn btn-success" disabled><span onclick="Close()">Send</span></button>
                </div>
          
            </div>
             <!-- <div class="col-3">
            <img src="{{url_for('static',filename='images/run.jpg')}}" height="400px" width="100%" />
          </div> -->
        </div>
    </div>

    <script>
        function Close(){
            document.getElementById('close').style.display='none'
            document.getElementById('speak1').style.display = "none"
        }

        function Text(){
         document.getElementById('text').style.display = 'block'
         document.getElementById('image').style.display = 'none'
         document.getElementById('audio').style.display = "none"
        }

        function Image(){
         document.getElementById('text').style.display = 'none'
         document.getElementById('image').style.display = 'block'
         document.getElementById('audio').style.display = "none"
        }

        function Audio(){
          document.getElementById('audio').style.display = "block"
          document.getElementById('text').style.display = 'none'
          document.getElementById('image').style.display = 'none'
        }

        function Speak(){
          document.getElementById('speak1').style.display = "block"
        }

        //Speech

      const d = new Date();
      const h = d.getHours();
      const min = d.getMinutes();
      const sec = d.getSeconds();
      const ms = d.getMilliseconds();  

      audio_name=`${h}-${min}-${sec}-${ms}`

      


      let mediaRecorder;
    let audioChunks = [];

    document.getElementById('startBtn').onclick = async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = e => {
        audioChunks.push(e.data);
      };

      mediaRecorder.onstop = async () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        const formData = new FormData();
        formData.append('audio', audioBlob, `recorded${h}${min}${sec}${ms}.webm`);

        await fetch('/upload-audio', {
          method: 'POST',
          body: formData
        }).then(res => res.json()).then(data => {
          // alert(data.message || data.error);
          const existingBox = document.getElementById('close');
  if (existingBox) {
    existingBox.remove(); // remove old one if it exists
  }

  const outputBox = document.createElement('div');
  outputBox.className = 'output-box';
  outputBox.id = 'close';
  outputBox.innerHTML = `
    <span class="span-close" onclick="Close()">close</span>
    ${data.rel}
  `;
  document.body.appendChild(outputBox);
        });

        audioChunks = [];
      };

      mediaRecorder.start();
      document.getElementById('startBtn').disabled = true;
      document.getElementById('stopBtn').disabled = false;
    };

    document.getElementById('stopBtn').onclick = () => {
      mediaRecorder.stop();
      document.getElementById('startBtn').disabled = false;
      document.getElementById('stopBtn').disabled = true;
    };
    </script>
</body>
</html>